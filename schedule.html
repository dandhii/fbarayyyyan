<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jadwal - FBA Rayyan Soccer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Roboto:wght@400;700&display=swap');
        
        body { font-family: 'Roboto', sans-serif; background-color: #f3f4f6; overflow-x: hidden; }
        h1, h2, .calendar-header { font-family: 'Oswald', sans-serif; }

        /* Container Kalender agar bisa digeser di HP */
        .calendar-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; /* Scroll halus di iPhone */
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        /* Lebar Kolom Diatur Pas (Pas untuk 7 kolom di desktop, geser di HP) */
        .calendar-grid { 
            display: grid; 
            grid-template-columns: repeat(7, minmax(130px, 1fr)); 
            min-width: 910px; /* 130px * 7 kolom agar konten jam tidak berhimpitan */
        }

        .calendar-day { 
            min-height: 140px; 
            border: 0.5px solid #f1f5f9; 
            padding: 6px; 
            background: #fff; 
        }

        .calendar-header { 
            background: #000; color: #fbbf24; 
            padding: 10px 0; text-align: center; 
            font-size: 13px; text-transform: uppercase; 
        }

        /* Slot Jam yang Kompak */
        .time-slot { 
            display: flex; flex-direction: column; 
            padding: 4px; margin-bottom: 4px; 
            background: #f8fafc; border: 1px solid #e2e8f0; 
            border-radius: 6px; text-align: center; 
            transition: 0.2s; text-decoration: none; 
        }
        .time-slot:hover { background: #fef3c7; border-color: #fbbf24; }
        
        .slot-time { font-size: 11px; font-weight: 800; color: #1e293b; }
        .slot-price { font-size: 9px; color: #059669; font-weight: bold; margin-top: 1px; }
        
        /* Status Warna */
        .pending { background-color: #fef08a !important; border-color: #facc15 !important; } 
        .booked { background-color: #ef4444 !important; color: #fff !important; pointer-events: none !important; } 
        .booked .slot-time, .booked .slot-price { color: #fff; }
        
        .empty-day { background-color: #f8fafc; }

        /* Indikator Geser untuk User HP */
        .scroll-hint {
            display: none;
            text-align: center;
            font-size: 10px;
            color: #94a3b8;
            margin-bottom: 8px;
        }
        @media (max-width: 768px) { .scroll-hint { display: block; } }
    </style>
</head>
<body>

    <nav class="bg-black text-white p-4 shadow-md flex justify-between items-center sticky top-0 z-50">
        <a href="index.html" class="flex items-center">
            <h1 class="text-xl uppercase italic font-bold">FBA RAYYAN <span class="text-yellow-500 font-light">SOCCER</span></h1>
        </a>
    </nav>

    <div class="max-w-[1400px] mx-auto p-4 flex flex-col lg:flex-row gap-6">
        <div class="flex-grow">
            <div class="flex justify-between items-center mb-4">
                <button onclick="changeMonth(-1)" class="bg-black text-white px-4 py-2 rounded-lg text-xs font-bold hover:bg-yellow-500 transition tracking-tighter">PREV</button>
                <h2 id="currentMonth" class="text-lg font-bold uppercase tracking-widest text-black"></h2>
                <button onclick="changeMonth(1)" class="bg-black text-white px-4 py-2 rounded-lg text-xs font-bold hover:bg-yellow-500 transition tracking-tighter">NEXT</button>
            </div>

            <p class="scroll-hint"><i class="fa-solid fa-arrows-left-right"></i> Geser tabel ke samping untuk melihat jadwal lengkap</p>
            
            <div class="calendar-wrapper">
                <div class="calendar-grid">
                    <div class="calendar-header">Senin</div><div class="calendar-header">Selasa</div><div class="calendar-header">Rabu</div>
                    <div class="calendar-header">Kamis</div><div class="calendar-header">Jumat</div><div class="calendar-header text-red-500">Sabtu</div>
                    <div class="calendar-header text-red-500">Minggu</div>
                </div>
                <div id="calendarGrid" class="calendar-grid"></div>
            </div>
        </div>

        <div class="lg:w-72 flex-shrink-0">
            <div class="bg-blue-700 text-white p-3 rounded-t-xl font-bold uppercase italic text-xs">Aturan Booking Lapangan:</div>
            <div class="bg-white p-5 rounded-b-xl shadow-lg text-[11px] leading-relaxed space-y-4 border-x border-b">
                <div>
                    <h3 class="font-bold text-blue-700 mb-1 uppercase">1. Cancel</h3>
                    <p>Pembatalan = Uang HANGUS. Tidak bisa ubah jadwal mendadak.</p>
                </div>
                <div>
                    <h3 class="font-bold text-blue-700 mb-1 uppercase">2. Status Warna</h3>
                    <div class="flex gap-2 items-center mb-1">
                        <span class="w-3 h-3 bg-yellow-400 rounded"></span> <span>Proses (Batas 15 Menit)</span>
                    </div>
                    <div class="flex gap-2 items-center">
                        <span class="w-3 h-3 bg-red-500 rounded"></span> <span>Full / Lunas</span>
                    </div>
                </div>
                <div class="bg-blue-50 p-3 rounded-lg text-blue-800 italic font-bold">
                    Booking wajib lunas. Gratis 1 dus air mineral (kecuali pelajar).
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = { databaseURL: "https://fba-rayyan-default-rtdb.asia-southeast1.firebasedatabase.app/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentDate = new Date();
        const timeSlots = ["06:00", "08:00", "10:00", "12:00", "14:00", "16:00", "18:00", "20:00", "22:00"];

        function getPrice(dateStr, timeStr) {
            const date = new Date(dateStr);
            const isWeekend = (date.getDay() === 0 || date.getDay() === 6);
            const hour = parseInt(timeStr.split(':')[0]);
            if (isWeekend) {
                if (hour <= 14) return "500K";
                if (hour === 16) return "800K";
                if (hour >= 18 && hour <= 20) return "1.000K";
                return "800K";
            } else {
                if (hour <= 14) return "400K";
                if (hour === 16) return "650K";
                if (hour >= 18 && hour <= 20) return "800K";
                return "650K";
            }
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthLabel = document.getElementById('currentMonth');
            grid.innerHTML = "";
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            monthLabel.innerText = `${monthNames[month]} ${year}`;
            
            let firstDay = new Date(year, month, 1).getDay();
            let startOffset = (firstDay === 0) ? 6 : firstDay - 1;
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < startOffset; i++) { grid.innerHTML += `<div class="calendar-day empty-day"></div>`; }

            for (let day = 1; day <= daysInMonth; day++) {
                const fullDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                let html = `<div class="calendar-day"><span class="text-[10px] font-black mb-2 block border-b pb-1 text-gray-400">${day}</span>`;
                timeSlots.forEach(time => {
                    const priceLabel = getPrice(fullDate, time);
                    html += `<a href="booking.html?time=${time}&date=${fullDate}" class="time-slot" data-date="${fullDate}" data-time="${time}"><span class="slot-time">${time}</span><span class="slot-price">Rp ${priceLabel}</span></a>`;
                });
                grid.innerHTML += html + `</div>`;
            }
            fetchBookings();
        }

        function fetchBookings() {
            db.ref('bookings').on('value', (snapshot) => {
                const data = snapshot.val();
                if (!data) return;
                Object.values(data).forEach(booking => {
                    const el = document.querySelector(`[data-date="${booking.date}"][data-time="${booking.time}"]`);
                    if (el) {
                        if (booking.status === "Lunas") {
                            el.classList.add('booked');
                            el.innerHTML = `<span class="slot-time">${booking.time}</span><span class="slot-price">FULL</span>`;
                        } else {
                            el.classList.add('pending');
                            el.querySelector('.slot-price').innerText = "PROSES";
                        }
                    }
                });
            });
        }

        function changeMonth(s) { currentDate.setMonth(currentDate.getMonth() + s); renderCalendar(); }
        renderCalendar();
    </script>
</body>
</html>